# AWS EC2

Elastic Compute Cloud (EC2), run server instances in AWS

Pricing Models:

- On Demand: fixed rate by hour, no commitment
- Reserved: reserved capacity at a discount
- Spot: use AWS's excess capacity at a discount
- Dedicated Hosts: Physical EC2 servers reserved for your use

EC2 Instance types, quick summary:

- T3 (Lowest Cost, General Purpose; web servers, small databases)
- M5 (General Purpose; for application servers)
- C5 (Compute Optimized; cpu intensive apps, databases)
- ...
- All types: F, I, G, H, T, D, R, M, C, P, X, Z, A, U

## Userdata

Userdata: Scripts executed on instance create

Debugging userdata:

	less /var/log/cloud-init-output.log

## Security Groups

- **Security group** is a named set of inbound/outbound rules within a given VPC
- Several security groups can be assigned to a single EC2 instance
- Security group rules are stateful: return traffic is automatically allowed, regardless of any rules

Rule defaults:

- All inbound traffic is blocked by default
- All outbound traffic is allowed by default

## EBS, Snapshots

Ebs = Amazon Elastic Block Store (EBS)

Types:

- SSD (General Purpose (gp2), Provisioned IOPS (io1))
- Magnetic (Throughput Optimized HDD (st1), Cold HDD (sc1), "Magnetic" (Standard))

EBS Change management:

- EBS block storage types and sizes can be changed on-the-fly without stopping attached instance (affects performance during resize)
- Moving EBS to another AZ: you have to create a snapshot, and create new volume from it
- EBS volumes can also be packaged as images
- When EC2 instance is killed:
  - By default, root volume is deleted
  - By default, additional volumes are persisted

Snapshots:

- Point in time copies of volumes
- Are stored in S3
- Incremental; only content delta is stored
- Stop instances before taking snapshots to ensure consistency

## AMI

AMI = Amazon Machine Image

Storage Types:

- EBS ("EBS-backed volume")
  - Persistent storage, EBS volume is persisted if instance is stopped
  - You can configure EBS volumes to persist after instance termination
- Instance Store ("Ephemeral storage")
  - Instance-stored backed EC2 instances cannot be stopped at all
  - Ephemeral: data is bound to instance lifecycle and is always lost on terminate
  - Underlying (virtualization) host fails: data is lost too
  - Can be rebooted, does not lose data

## Volume Encryption

- Root device volumes can nowadays be encrypted on initial provision
- Encryption in sanpshots can be changed by creating a snapshot copy with new encryption setting
- Only unencrypted snapshots can be shared (publicly or with other AWS accounts

## CloudWatch & CloudTrail

- CloudWatch: AWS (performance) monitoring service (=how good is performance of X)
- CloudTrail: audit tool that records user activity in AWS (=who did what)
- EC2: CloudWatch monitoring is can be optionally enabled for EC2 instances

CloudWatch can monitor:

- host level metrics (CPU, network, disk, status checks)
- Default monitoring interval: 5 minutes
- Detailed monitoring interval: 1 minute

Alarms:

- Basic idea: whenever a given metric (like CPU) is below/above a given value for n datapoints, alarm is triggered
- Alarms can trigger email notifications

Events:

- Respond to state changes with events

Logs:

- Log data storage, monitoring and aggregation
